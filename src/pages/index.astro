---
import { getLangFromUrl, useRouter, useTranslations } from "src/i18n";
import Layout from "src/layouts/layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import SeparatorLink from "src/components/molecules/separator-link.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const router = useRouter(lang);

const blogPosts = await getCollection("blog", ({ id }) => {
  return id.startsWith(`${lang}/`);
});

const recentBlogPosts = blogPosts
  .sort((a, b) => b.data.releaseDate.getTime() - a.data.releaseDate.getTime())
  .slice(0, 3);
---

<Layout routeKey="home">
  <div class="p-2 sm:p-4 md:p-6 space-y-4 md:space-y-6">
    {/* About me */}
    <div class="space-y-4 md:space-y-6">
      <h1
        class="font-display text-3xl text-zinc-900 dark:text-zinc-100 whitespace-pre-line"
      >
        {t("pages.home.title")}
      </h1>
      <p
        class="font-sans text-sm text-zinc-700 dark:text-zinc-300 whitespace-pre-line"
      >
        {t("pages.home.subtitle")}
      </p>
      <SeparatorLink
        href={router("/about")}
        label={t("pages.home.aboutRedirect")}
        icon="about"
      />
    </div>

    {/* Recent blog posts */}
    <div class="space-y-2">
      <h3
        class="font-display font-semibold text-lg text-zinc-900 dark:text-zinc-100"
      >
        {t("pages.home.myRecentPosts")}
      </h3>
      <ul class="grid-cols-1 lg:grid-cols-3 grid gap-4">
        {
          recentBlogPosts.map((post) => (
            <li class="w-full h-[200px] lg:h-[300px] relative bg-transparent shadow-sm rounded-lg overflow-hidden transition-opacity hover:opacity-80">
              <a href={router(`/blog/${post.slug}`)}>
                <Image
                  class="object-cover object-center w-full h-full"
                  width={800}
                  height={800}
                  src={post.data.image.url}
                  alt={post.data.image.alt}
                />
                <div class="absolute w-full bg-black/25 bottom-0 px-4 py-2 space-y-2">
                  <h2 class="font-display font-semibold text-base text-white line-clamp-1">
                    {post.data.title}
                  </h2>
                  <p class="text-sm text-zinc-200 line-clamp-2">
                    {post.data.subtitle}
                  </p>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </div>
    <SeparatorLink
      href={router("/blog")}
      label={t("pages.home.blogRedirect")}
      icon="blog"
    />
  </div>
</Layout>
